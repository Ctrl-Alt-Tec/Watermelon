<!DOCTYPE html>
<html lang="en">
<head>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.6.2/firebase-firestore.js"></script>


    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-analytics.js"></script>

    <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyBaAIgZY3coG_Vlhv5UdZrqrlxTeLm_-RE",
        authDomain: "watermelon-974ca.firebaseapp.com",
        databaseURL: "https://watermelon-974ca.firebaseio.com",
        projectId: "watermelon-974ca",
        storageBucket: "watermelon-974ca.appspot.com",
        messagingSenderId: "458674442702",
        appId: "1:458674442702:web:42fa5b0b32ce9253381b9f",
        measurementId: "G-YMWDNF8GGQ"
    }; 
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    let db = firebase.firestore();

    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Watermelon</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="WMToolbar.css">
    <style>

        body{

            font-family: 'Montserrat', sans-serif;
            margin: 0px;
            background: #303030; 
        }
        .container_posts{
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            background: #303030;
        }
        .post{
            width: 100%;
            max-width: 300px;
            height: 400px;
            margin: 8px;
            padding: 8px;  
            color: white;
        }
        .post .post_image{
            width: 100%;
            height: 50%;
            background-size: cover !important;
            background-position: center center !important;
        }
        .post h1.post_title, .post h3.post_subtitle{
            margin: 8px 0px;
        }
        .post h1.post_title{
            font-size: 2em;
        }
        .post h3.post_subtitle{
            color: grey; 
            font-size: 1.5em;
        }
        .post .post_author{
            margin-bottom: 8px;
        }

        .addPost{
            line-height: 80px;
            text-align: center;
            text-decoration: none;
            width: 80px;
            height: 80px;
            background-color: #95E3BB;
            cursor: pointer;
            float: right;
            margin-top: -80px;
            margin-right: 5px;
            font-size: 50px;
            border-radius: 50%;
            position: fixed;
            bottom: 24px;
            right: 24px
        }
        
        
    </style>
</head>  
<body>
    <div class="container_posts">
    </div>

    <div class="addPost">
        +
    </div> 
    <script src="WMToolbar.js"></script>

    <script>
        class Post {
            constructor(id, data, options){
                this.dom = document.createElement('div');
                this.dom.classList.add("post");

                let img = document.createElement('div');
                img.style.background = "url('"+data.image+"')";
                img.classList.add('post_image');

                let title = document.createElement('h1');
                title.classList.add("post_title");
                title.innerText = data.title;
                
                let author = document.createElement('div');
                author.classList.add("post_author");
                author.innerText = data.author;
                
                let date = document.createElement('div');
                date.classList.add("post_date");
                //date.innerText = data.date.toLocaleDateString();
                
                let subtitle = document.createElement('h3'); 
                subtitle.classList.add("post_subtitle"); 
                subtitle.innerText = data.subtitle; 

                this.dom.append(img, title, subtitle, author, date);

                this.dom.addEventListener('click', function(){
                    options.onClick(id);
                })

            }
        }

        let posts = [
            {
                title: "Esto es un post", 
                subtitle: "Subtítulo",
                image: "https://res.cloudinary.com/devex/image/fetch/c_scale,f_auto,q_auto,w_720/https://lh4.googleusercontent.com/VQyrPPyh-FGdV2BJtlcwDphesnxERD6SLWvGtARygLDVNSsXhFF0kzG_yXvLyiARZbKIG3VYF_CIbF4_B-Wy3Eu7kKhHKKR3pq_2ob2pdZgxt_Wz_uqXjRMrhIBKREQnJo--Ui9b", 
                date: new Date(), 
                author: "@edvilme",
                section: "Blog"
            }, 
            {
                title: "Esto es un post", 
                subtitle: "Subtítulo",
                image: "https://res.cloudinary.com/devex/image/fetch/c_scale,f_auto,q_auto,w_720/https://lh4.googleusercontent.com/VQyrPPyh-FGdV2BJtlcwDphesnxERD6SLWvGtARygLDVNSsXhFF0kzG_yXvLyiARZbKIG3VYF_CIbF4_B-Wy3Eu7kKhHKKR3pq_2ob2pdZgxt_Wz_uqXjRMrhIBKREQnJo--Ui9b", 
                date: new Date(), 
                author: "@edvilme",
                section: "Blog"
            }, 
            {
                title: "Título", 
                subtitle: "Subtítulo",
                image: "https://cdn.pixabay.com/photo/2018/05/28/22/11/message-in-a-bottle-3437294__340.jpg",
                date: new Date(), 
                author: "@loulou",
                section: "Recursos"
            },
            {
                title: "Esto es un reto", 
                subtitle: "Subtítulo",
                image: "https://cdn.pixabay.com/photo/2018/05/28/22/11/message-in-a-bottle-3437294__340.jpg",
                date: new Date(), 
                author: "@loulou",
                section: "Retos"
            },
            {
                title: "Esto es un post", 
                subtitle: "Subtítulo",
                image: "https://res.cloudinary.com/devex/image/fetch/c_scale,f_auto,q_auto,w_720/https://lh4.googleusercontent.com/VQyrPPyh-FGdV2BJtlcwDphesnxERD6SLWvGtARygLDVNSsXhFF0kzG_yXvLyiARZbKIG3VYF_CIbF4_B-Wy3Eu7kKhHKKR3pq_2ob2pdZgxt_Wz_uqXjRMrhIBKREQnJo--Ui9b", 
                date: new Date(), 
                author: "@edvilme",
                section: "Blog"
            },
            {
                title: "Esto es un taller", 
                subtitle: "Subtítulo",
                image: "https://res.cloudinary.com/devex/image/fetch/c_scale,f_auto,q_auto,w_720/https://lh4.googleusercontent.com/VQyrPPyh-FGdV2BJtlcwDphesnxERD6SLWvGtARygLDVNSsXhFF0kzG_yXvLyiARZbKIG3VYF_CIbF4_B-Wy3Eu7kKhHKKR3pq_2ob2pdZgxt_Wz_uqXjRMrhIBKREQnJo--Ui9b", 
                date: new Date(), 
                author: "@edvilme",
                section: "Talleres"
            }
        ]

        


        document.body.prepend( new WMToolbar({
            sections: [
                'Inicio', 'Blog', 'Retos', 'Talleres', 'Recursos'
            ],
            sectionsOnClick: function(section){
                showByType(section)
            },
            logo: {
                src: "https://ctrl-alt-tec.hackclub.com/watermelon/logo.png",
            }, 
            background: "black"
        }).dom )


        async function getPosts(){
            return new Promise(function(resolve, reject){
                db.collection("posts").get().then(function(posts){
                    resolve(posts);
                })
            })
        }
 
        async function showByType(type){
            let _posts = await getPosts();
            document.querySelector('.container_posts').innerHTML = ""
            if(type == "Inicio"){
                _posts.forEach(function(item){
                    document.querySelector('.container_posts').append(new Post(item.id, item.data(), {
                        onClick: function(id){ console.log(id); window.location.href = 'editor.html?post='+id }
                    }).dom)
                }) 
            }else{
                _posts.filter(function(item){ return item.data().section==type }).forEach(function(item){
                    document.querySelector('.container_posts').append(new Post(item.id, item.data(), {
                        onClick: function(id){ console.log(id); window.location.href = 'editor.html?post='+id }
                    }).dom)   
                })
            }
        }

        showByType("Inicio")

    </script>
</body>
</html>